{% load journal_extras %}

...

<td class="text-end">
  {% if request.user|can_manage:m %}
    <div class="btn-group btn-group-sm" role="group">
      <button
        hx-post="{% url 'journal:member_remove' m.id %}"
        hx-confirm="Remove {{ m.user.get_full_name|default:m.user.username }}?"
        hx-target="#member-{{ m.id }}" hx-swap="outerHTML"
        class="btn btn-outline-danger"
        {% if m.user == org.owner or m.user == request.user %}disabled{% endif %}
      >Remove</button>

      <a href="{% url 'admin:auth_user_change' m.user.id %}" class="btn btn-outline-secondary">
        Admin
      </a>
    </div>
  {% else %}
    <span class="text-body-secondary small">No permissions</span>
  {% endif %}
</td>

<tr id="member-{{ m.id }}">
  <td class="text-center text-muted">{{ forloop.counter }}</td>

  <td>
    <div class="d-flex align-items-center gap-2">
      <div class="rounded-circle bg-secondary-subtle" style="width:28px;height:28px;
           display:flex;align-items:center;justify-content:center;font-weight:600;">
        {{ m.user.get_full_name|default:m.user.username|first|upper }}
      </div>
      <div>
        <div class="fw-semibold">{{ m.user.get_full_name|default:m.user.username }}</div>
        {% if m.user == org.owner %}
          <span class="badge bg-primary-subtle text-primary-emphasis">Owner</span>
        {% endif %}
      </div>
    </div>
  </td>

  <td class="text-body-secondary text-truncate members-email">
    <span class="text-nowrap">{{ m.user.email|default:"â€”" }}</span>
  </td>

  <td>
    <div
      hx-post="{% url 'journal:member_role_change' m.id %}"
      hx-target="#member-{{ m.id }}"
      hx-swap="outerHTML"
      class="d-flex align-items-center gap-2"
    >
      <select name="role" class="form-select form-select-sm w-auto"
              onchange="this.closest('div').dispatchEvent(new Event('submit',{cancelable:true}))">
        {% for value,label in m.Role.choices %}
          <option value="{{ value }}" {% if m.role == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      {% if m.role == 'MODERATOR' %}
        <span class="badge bg-info-subtle text-info-emphasis">Can review</span>
      {% endif %}
    </div>
  </td>

  <td class="text-end">
    <div class="btn-group btn-group-sm" role="group">
      <button
        hx-post="{% url 'journal:member_remove' m.id %}"
        hx-confirm="Remove {{ m.user.get_full_name|default:m.user.username }}?"
        hx-target="#member-{{ m.id }}" hx-swap="outerHTML"
        class="btn btn-outline-danger"
        {% if m.user == org.owner or m.user == request.user %}disabled{% endif %}
      >
        Remove
      </button>
      <a href="{% url 'admin:auth_user_change' m.user.id %}" class="btn btn-outline-secondary">
        Admin
      </a>
    </div>
  </td>
</tr>